<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
</head>
<body>
    <h1>Maestro detalle empleados departamento</h1>
    <ul id="listadepartamentos"></ul><br>
    <table id="tablaempleados" border="1">
        <thead><tr>
            <th>ID</th><th>Apellido</th><th>Oficio</th><th>Salario</th><th>Departamento</th>
        </tr></thead>
        <tbody></tbody>
    </table>

    <script src="js/jquery-3.7.1.js"></script>
    <script>
        let urlDept = "https://apicruddepartamentospgs.azurewebsites.net/"
        let urlEmp = "https://apiempleadosspgs.azurewebsites.net/"
        $(document).ready(function(){
            var request = "webresources/departamentos"
            $.ajax({
                url: urlDept+request,
                method:"GET",
                dataType: "json",
                success: function(data){
                    console.log(data)
                    var html = ""
                    $.each(data, function(index, departamento){
                        var li = $("<li>",{"text":departamento.nombre, "data-numero": departamento.numero})
                        li.appendTo($("#listadepartamentos"));
                        var linkEmp = $("<a>", {"href": "#","text":"Empleados", "data-dept":departamento.numero})
                        linkEmp.appendTo(li)
                        linkEmp.click(function(){
                            
                            $("#tablaempleados tbody").html("")
                         
                            html = ""
                            var request = "api/Empleados/EmpleadosDepartamento/"+$(this).attr("data-dept")
                            console.log(request)
                            $.getJSON(urlEmp+request, function(data){
                                $.each(data, function(index, empleado){
                                    html += "<tr>"
                                    html += "<td>"+empleado.idEmpleado+"</td>"
                                    html += "<td>"+empleado.apellido+"</td>"
                                    html += "<td>"+empleado.oficio+"</td>"
                                    html += "<td>"+empleado.salario+"</td>"
                                    html += "<td>"+empleado.departamento+"</td>"
                                    html += "</tr>"
                                })
                                $("#tablaempleados tbody").html(html)
                            })
                        })
                    })
                }
            })
        })
    </script>
</body>
</html>